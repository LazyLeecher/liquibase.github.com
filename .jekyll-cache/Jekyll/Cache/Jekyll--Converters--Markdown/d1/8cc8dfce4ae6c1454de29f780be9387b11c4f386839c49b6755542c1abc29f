I"³'<p>Early on, Liquibase only supported XML changelogs with each changeSet listed in it. There are many advantages to using that setup, but there are now many different ways to store your database changes.</p>

<p>One way to manage your changes is to store them in individual SQL files.  Some people prefer this setup because it is similar to other tools they have used, because they find SQL more natural to work with than XML, or they prefer to work with smaller files in a directory than changeSets stored in a large file. It is also helpful when migrating to Liquibase from an older system that manages changes as individual files.</p>

<h3 id="master-changelog">Master Changelog</h3>

<p>To bootstrap the process, you need a master changelog file that uses the includeAll command. I know the title said â€œLiquibase Without Changelogs,â€ but once you have created this file you never have to touch it again.</p>

<p><strong>File â€œcom/example/liquibase/changelog.xmlâ€</strong></p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="nt">&lt;databaseChangeLog</span> <span class="na">xmlns=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog"</span>
                   <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
                   <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;includeAll</span> <span class="na">path=</span><span class="s">"com/example/liquibase"</span> <span class="na">filter=</span><span class="s">"sql"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre></figure>

<p>The includeAll command is telling Liquibase to run all the SQL files in the â€œcom/example/liquibaseâ€ directory.</p>

<p>Now, when you run <code class="highlighter-rouge">liquibase --changeLogFile=com/example/liquibase/changelog.xml update</code> Liquibase will look for files with an SQL extension in com/example/liquibase and treat each as a changeSet. The files will be executed in alphabetical order.</p>

<h3 id="example-usage">Example Usage</h3>

<p>Create a file â€œcom/example/liquibase/0010-create-address.sqlâ€ containing</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">create</span> <span class="k">table</span> <span class="n">address</span> <span class="p">(</span><span class="n">id</span> <span class="nb">int</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="n">line1</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">line2</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">));</span></code></pre></figure>

<p>Now run liquibase update and you will see an â€œUpdate Successfulâ€ message and the new address table in your database.</p>

<p>If you run liquibase update update again, Liquibase knows that the SQL file already ran and does not try to re-create your table.</p>

<p>You can see what Liquibase is tracking by running select id, author, filename from databasechangelog and you will see a row with id=â€rawâ€, author=â€includeAllâ€, filename=â€com/example/liquibase/0010-create-address.sqlâ€. The SQL file is being managed like any other changeSet, using a generated author of â€œincludeAllâ€ and id of â€œrawâ€.</p>

<p>Now create another file â€œcom/example/liquibase/0020-address-insert.sqlâ€ containing:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">insert</span> <span class="k">into</span> <span class="n">address</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">'121 Main Ave'</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">address</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">'662 Broadway'</span><span class="p">,</span> <span class="s1">'Suite 3317'</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">address</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">'412 Riverview'</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span></code></pre></figure>

<p>and run liquibase update again.</p>

<p>This time data will be inserted into the table and if you select from databasechangelog there will now be a second row containing id=â€rawâ€, author=â€includeAllâ€, filename=â€com/example/liquibase/0020-insert-address.sqlâ€</p>

<p>Continue adding SQL files to build your database.</p>

<h3 id="things-to-consider-file-naming">Things to consider: File Naming</h3>

<p>Liquibase simply execute files in alphabetical order and will track what has ran based on the filename.</p>

<p>Therefore, choose a naming pattern that is easy for you to use but also leaves you open to sneak in new changeSets between existing ones down the road if you need. In the above example, I used a pattern of a zero-padded 4 digit number that increments by 10 followed by a simple description of what is in the file. The zero-padding will preserve the correct alphabetical file ordering while the incrementing by 10 allows me to add a â€œ0011-increase-address-size.sqlâ€ file if I realize one needs to be added â€œbeforeâ€ the 0020 file. If I hit the limit of the 10 increment or the 1000 zero padded length, continue on with letters. 001a.sql will come after 0019 alphabetically.</p>

<p>Also make sure you use a consistent case for your filenames. Some systems will sort them case sensitively and others will not, so for best portability pick a case and stick to it.</p>

<h3 id="things-to-consider-checksums">Things to consider: checksums</h3>

<p>Like all changeSets, Liquibase tracks the checksum of the changeSet when it was executed against each database. So, if you modify a SQL file after it has been executed somewhere, Liquibase will throw an error on the next update saying that the checksum has changed. Therefore, each new step in your database migration should be in its own fileâ€“donâ€™t append to an existing file.</p>

<h3 id="things-to-consider-transactions">Things to consider: transactions</h3>

<p>Like all changeSets, Liquibase will try to run each SQL file in its own transaction. Since most statements are auto-committing on most databases, it is best to have a single statement per SQL file. Otherwise, if the second statement fails but the first auto-commits, Liquibase will be in an indeterminate state due to the half-ran changeSet.</p>

<h3 id="liquibase-formatted-sql">Liquibase Formatted SQL</h3>

<p>Rather than using standard SQL in your files, consider using <a href="http://www.liquibase.org/documentation/sql_format.html">Liquibase-formatted SQL</a> for some or all of your files. Liquibase-formatted SQL is designed to be backwards-compatible with standard SQL but allows you more flexibility and power within Liquibase, such as the ability to run preconditions, use changelog parameters, filter statements by database or context, and more. Liquibase-formatted SQL also allows you to specify multiple changeSet blocks within a single file.</p>

<p>To try a Liquibase-formatted file, create a file com/example/liquibase/0030-start-cart.sql</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">--liquibase formatted sql</span>
<span class="c1">--changeset nvoxland:1</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">cart</span> <span class="p">(</span><span class="n">id</span> <span class="nb">int</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="n">created_date</span> <span class="nb">date</span><span class="p">);</span>

<span class="c1">--changeset nvoxland:2</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">cart_item</span> <span class="p">(</span><span class="n">id</span> <span class="nb">int</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="n">created_date</span> <span class="nb">date</span><span class="p">,</span> <span class="n">cart_id</span> <span class="nb">int</span><span class="p">,</span> <span class="n">line_item</span> <span class="nb">int</span><span class="p">,</span> <span class="n">quantity</span> <span class="nb">int</span><span class="p">);</span></code></pre></figure>

<p>After running liquibase update, when you select from databasechangelog you will see a row with id=â€1â€ author=â€nvoxlandâ€ filename=â€com/example/liquibase0030-start-cart.sqlâ€ and a row with id=â€2â€ author=â€nvoxlandâ€ filename=â€com/example/liquibase0030-start-cart.sqlâ€. Because of the formatting, Liquibase is seeing each chunk of the file as a separate changeSet and any new changesets you append to the file will be handled correctly as well.</p>

<p><em>(Originally posted to the <a href="http://www.datical.com/liquibase-without-changelogs/">Datical.com blog</a>)</em></p>
:ET