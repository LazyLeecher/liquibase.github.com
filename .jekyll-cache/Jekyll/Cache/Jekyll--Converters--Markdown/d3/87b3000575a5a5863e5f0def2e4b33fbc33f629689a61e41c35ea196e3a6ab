I"Ô7<p>Liquibase 3.4.0 has been released and is working it‚Äôs way through the Maven mirrors.</p>

<p>Downloads are available at <a href="/download">http://liquibase.org/download</a>. Question or comments can be directed <a href="http://liquibase.org/community">here</a></p>

<p>Lots of good things in 3.4.0, but some highlights include:</p>

<h3 id="you-can-now-save-snapshots-and-later-reuse-them-for-diff-generatechangelog-and-more">You can now save snapshots and later reuse them for diff, generateChangeLog, and more</h3>

<p>We previously added the ability to use ‚Äúoffline‚Äù databases which allows you to specify a url of ‚Äúoffline:mysql‚Äù for updateSql.
With 3.4.0, there is a new <code class="highlighter-rouge">--snapshotFormat=json</code> attribute you can pass to the snapshot command which will output the snapshot in machine-readable JSON.</p>

<figure class="highlight"><pre><code class="language-console" data-lang="console"><span class="gp">liquibase --url=jdbc:mysql://localhost/lbcat snapshot --snapshotFormat=json &gt;</span><span class="w"> </span>snapshot.json</code></pre></figure>

<p>You can then use that snapshot with offline mode and any snapshot operations will use what is in the snapshot file as the database state.</p>

<ul>
  <li><strong>liquibase ‚Äìurl=jdbc:mysql://localhost/lbcat ‚ÄìreferenceUrl=offline:mysql?snapshot=path/to/snapshot.json diff</strong> will compare the stored snapshot with the current database state</li>
  <li><strong>liquibase ‚Äìurl=offline:mysql?snapshot=path/to/snapshot.json diff ‚ÄìreferenceUrl=offline:mysql?snapshot=path/to/older-snapshot.json diff</strong> will compare two snapshots</li>
  <li><strong>liquibase ‚Äìurl=offline:mysql?snapshot=path/to/snapshot.json generateChangeLog</strong> will generate a changelog based on what is in the snapshot</li>
  <li><strong>liquibase ‚Äìurl=jdbc:mysql://localhost/lbcat ‚ÄìreferenceUrl=offline:mysql?snapshot=path/to/snapshot.json diffChangeLog</strong> will generate a changelog based on what is new in the real database compared to what is in the snapshot.</li>
</ul>

<h3 id="changelog-properties-can-be-defined-as-local-to-the-changelog-not-global">Changelog properties can be defined as local to the changelog, not global</h3>

<p>Previously, changelog properties were ‚Äúwrite once‚Äù and global. Meaning that once you define a property, it cannot be overridden and is applicable to all changelogs.</p>

<p>You can now use the <code class="highlighter-rouge">global="false"</code> flag in properties defined in a changeSet and the property will only apply to that changeLog.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;databaseChangeLog&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"varchar_type"</span> <span class="na">value=</span><span class="s">"NVARCHAR"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"boolean_type"</span> <span class="na">value=</span><span class="s">"BIT"</span> <span class="na">global=</span><span class="s">"false"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/databaseChangeLog&gt;</span></code></pre></figure>

<p>The type varchar_type will be set to NVARCHAR across all changelog files, but the boolean_type value will only be BIT within this file and will be undefined elsewhere.</p>

<h3 id="index-descending-can-be-more-easily-defined">Index descending can be more easily defined</h3>

<p>Previously, if you wanted to control if an index is ASC or DESC you needed to use modifySql or just list the column name as ‚Äúname DESC‚Äù. There is now a ‚Äúdescending‚Äù boolean flag that can be specified in createTable and createIndex changes.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;createIndex</span> <span class="na">tableName=</span><span class="s">"my_table"</span> <span class="na">indexName=</span><span class="s">"my_index"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"registration_time"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">descending=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/createIndex&gt;</span></code></pre></figure>

<h3 id="performance-improvements">Performance improvements</h3>

<p>There was significant work done to improve snapshot time as well as loaddata. The metadata queries were improved and the amount of metadata that needs to be read for some operations was greatly decreased.</p>

<p>The larger your databases are, the more of an improvement you should see.</p>

<h3 id="new-tagexists-command">New tagExists command</h3>

<p>Are you wondering if you have already used a given tag? Use <code class="highlighter-rouge">liquibase tagExists tagName</code> to find out.</p>

<h3 id="full-release-notes">Full Release Notes</h3>

<p>Thanks to everyone who helped with <a href="https://liquibase.jira.com/jira/secure/ReleaseNote.jspa?projectId=10020&amp;version=11960">all these issues</a></p>

<ul>
  <li>[CORE-14] - Dropping default values with MS-SQL</li>
  <li>[CORE-822] - Add a tag to add/update table/column remarks</li>
  <li>[CORE-864] - loaddata performance enhancement</li>
  <li>[CORE-1411] - MariaDB support</li>
  <li>[CORE-2254] - Ability to save snapshot for later comparison</li>
  <li>[CORE-2257] - Ability to use a previously saved database snapshot in diff and generateChangeLog</li>
  <li>[CORE-2302] - Add ability to load nested object/collection properties and BigDecimal properties automatically</li>
  <li>[CORE-2306] - Support passing in a script for rollback to override rollback logic included in the changelog</li>
  <li>[CORE-2308] - Track changeSet contexts and labels in databasechangelog table</li>
  <li>[CORE-2345] - Add XML Type</li>
  <li>[CORE-419] - Allowing ASC and DESC in index definitions</li>
  <li>[CORE-562] - Allow naming of not null constraints</li>
  <li>[CORE-715] - indexExists does a full snapshot</li>
  <li>[CORE-1731] - Support autoincrement in oracle 12c</li>
  <li>[CORE-2124] - Ability to pass properties to a JDBC driver required</li>
  <li>[CORE-2132] - Error message for missing sqlFile reference should be more descriptive</li>
  <li>[CORE-2147] - HsqlDatabase should emit uppercase names when quoting reserved words to preserve case insensitivity</li>
  <li>[CORE-2171] - New ChangeExecListener.runFailed method</li>
  <li>[CORE-2177] - Support NOT(X) syntax for labels</li>
  <li>[CORE-2185] - Few fields needs to be changed as protected and need additional field in RanChangeSet</li>
  <li>[CORE-2217] - Add DataTypeFactory support for delimited data type names, improve resolution of MSSQL data types</li>
  <li>[CORE-2228] - New usingIndexName attribute on addPrimaryKey</li>
  <li>[CORE-2236] - Support .yml extension in YamlChangeLogSerializer</li>
  <li>[CORE-2244] - Handle generating SQL Server DDL where ANSI NULL Default is false</li>
  <li>[CORE-2249] - Index and UniqueConstraint equivalence check should take name into account</li>
  <li>[CORE-2288] - Do not check/updatedatabasechangelog table on status</li>
  <li>[CORE-2292] - New tagExists command for command line</li>
  <li>[CORE-2298] - Allow HSQL to use defaultValueComputed for certain allowed functions on datetime type columns</li>
  <li>[CORE-2299] - Add capability to ignore missing or empty folder with includeAll</li>
  <li>[CORE-2307] - ChangeLog table name option in command line tool</li>
  <li>[CORE-2309] - global/local properties on changesets</li>
  <li>[CORE-2320] - MinGW (Git Bash) support for shell</li>
  <li>[CORE-2334] - Disable CREATE TABLE DATABASECHANGELOG generation when running on OfflineConnection</li>
  <li>[CORE-2336] - Use a grammer for parsing SQL rather than regexps</li>
  <li>[CORE-2358] - Improve data types for Liquibase tables in MSSQL</li>
  <li>[CORE-2359] - Consistently read dataTypeId for all databases</li>
  <li>[CORE-2363] - Improve robustness of MSSQL database case-insensitivity check</li>
  <li>[CORE-2371] - Improve Oracle snapshot performance</li>
  <li>[CORE-2386] - Set the connection default catalog/schema if defaultCatalogName or defaultSchemaName is set</li>
  <li>[CORE-2397] - MSSQL View Snapshot should not use sp_helptext</li>
  <li>[CORE-2399] - DBDoc improvements</li>
  <li>[CORE-2404] - Ability to preserve TEXT type in mssql snapshot and update</li>
  <li>[CORE-842] - Tag database not taking orderexecuted into account</li>
  <li>[CORE-1296] - drop column on ms sql server</li>
  <li>[CORE-1424] - SQL Generation ignores DATETIME parameters</li>
  <li>[CORE-1542] - Sequence is dropped not until a second run of dropAllDatabaseObjects on PostgreSQL</li>
  <li>[CORE-1738] - loadData from csv fails for boolean column (if another column present)</li>
  <li>[CORE-1749] - Update change command does not respect whereParams</li>
  <li>[CORE-1803] - DropAll doesn‚Äôt delete sequences if they are used as default value in postgres</li>
  <li>[CORE-1904] - Slow indexExists performance in Oracle</li>
  <li>[CORE-1924] - SQLServer diff - DATETIME2 not being handled correctly</li>
  <li>[CORE-2005] - /usr/bin/liquibase: Syntax error: ‚Äúelse‚Äù unexpected</li>
  <li>[CORE-2018] - Quotes stripped from index filter_conditions on snapshot</li>
  <li>[CORE-2019] - Comments in empty rollback prevent execution</li>
  <li>[CORE-2041] - Escaping of reserved keywords in HSQLDB</li>
  <li>[CORE-2096] - DiffChangeLog with changed indexes generates drop/add in the wrong order</li>
  <li>[CORE-2109] - dropAll fails for statements the database requires to run non-transactionally</li>
  <li>[CORE-2113] - Informix text datatype fixes</li>
  <li>[CORE-2133] - Oracle: GenerateChangeLog of a table with DEFAULT VALUE NULL creates defaultValueComputed=‚ÄùNULL‚Äù</li>
  <li>[CORE-2167] - Issues with generateChangeLog of unique constraints on DB2</li>
  <li>[CORE-2169] - offline mode seems non-deterministic</li>
  <li>[CORE-2178] - Fatal exception acquiring lock in SQL Server databases with case-sensitive collation</li>
  <li>[CORE-2196] - Ant: ‚ÄúUnable to update database.‚Äù without explanation</li>
  <li>[CORE-2209] - Oracle snapshot sometimes creates ‚ÄúGENERATED ALWAYS AS (null)‚Äù</li>
  <li>[CORE-2211] - Liquibase tries to execute commented lines in custom SQL file</li>
  <li>[CORE-2219] - DB2 for zOs - adding primary key always emits REORG but REORG does not exist on Db2 for zOs</li>
  <li>[CORE-2222] - TIMESTAMP parameters dropped for PostgreSQL</li>
  <li>[CORE-2224] - Index uniqueness is not always recognized correctly</li>
  <li>[CORE-2227] - CLONE - UpdateSQL needs to append a ‚Äú/‚Äù to the end of createProcedure for Oracle</li>
  <li>[CORE-2232] - Support schema other than public on PostgreSQL</li>
  <li>[CORE-2233] - Oracle Timestamp precision lost in generateChangeLog</li>
  <li>[CORE-2234] - columnExists precondition could be much faster (Oracle, mssql)</li>
  <li>[CORE-2237] - YamlChangeLogSerializer does not correctly serialize a changeset</li>
  <li>[CORE-2251] - Adding column with type DATETIME doesn‚Äôt work for PostgreSQL</li>
  <li>[CORE-2252] - XMLChangeLogSerializer writes array object for rollback tag content</li>
  <li>[CORE-2253] - Handle oracle varchar &lt;-&gt; clob conversions in diffChangeLog</li>
  <li>[CORE-2256] - Drop Sequences before Tables</li>
  <li>[CORE-2266] - DiffChangeLog: Invalid changelog when a primary key backing index is changed</li>
  <li>[CORE-2267] - Rollback fails for mixed-case objects created with QUOTE_ALL_OBJECTS</li>
  <li>[CORE-2270] - Doubledash inside quoted text causes parsing error</li>
  <li>[CORE-2271] - CLONE - DiffChangeLog: Invalid changelog when a unique constraint backing index is changed</li>
  <li>[CORE-2272] - DiffChangeLog must drop foreign keys before primary keys</li>
  <li>[CORE-2273] - Oracle char column snapshot not differentiating between a default value of 0 and ‚Äò0‚Äô</li>
  <li>[CORE-2275] - YAML update fails with Unexpected error running Liquibase: java.util.LinkedHashMap cannot be cast to java.util.List</li>
  <li>[CORE-2281] - Oracle snapshot performance issue with many multiple views</li>
  <li>[CORE-2291] - ObjectQuotingStrategy not reset correctly after changeSet</li>
  <li>[CORE-2295] - includeAll tries to load all files instead only *.xml</li>
  <li>[CORE-2300] - Unsigned Int / Bigint cannot be created</li>
  <li>[CORE-2305] - Snapshot output too verbose</li>
  <li>[CORE-2316] - Data type registry occasionally returns wrong data type implementation</li>
  <li>[CORE-2321] - Liquibase tag command tags too much</li>
  <li>[CORE-2324] - diffChangeLog does not handle changes in sequence incrementBy, maxValue or ordered</li>
  <li>[CORE-2331] - Support for MSSQL collation in data type description broken</li>
  <li>[CORE-2340] - Add support for extensions to override the built-in change log, snapshot serializers</li>
  <li>[CORE-2355] - Improve updateSQL performance</li>
  <li>[CORE-2361] - preConditions, rollback, property, include, includeAll cannot be serialized</li>
  <li>[CORE-2373] - Local DTD files not found in subdirectory</li>
  <li>[CORE-2378] - Adding a new ‚ÄúCustomChange‚Äù triggers ClassNotFoundException</li>
  <li>[CORE-2380] - Support reading of gzip files</li>
  <li>[CORE-2381] - Fix unique constraint generator for informix</li>
  <li>[CORE-2383] - Change formatted SQL stripComments default from ‚Äútrue‚Äù to ‚Äúfalse‚Äù</li>
  <li>[CORE-2385] - IncludeAll does not work when runing liquibase from inside a jar</li>
  <li>[CORE-2387] - dropPrimaryKey without constraint name on sql server doesn‚Äôt query schema correctly</li>
  <li>[CORE-2388] - Views not equal in different schemas</li>
  <li>[CORE-2390] - NullPointerException when generating changelog</li>
  <li>[CORE-2391] - column type doesn‚Äôt respect unsigned</li>
  <li>[CORE-2393] - changeSet contexts created with maven generateChangeLog are in parentheses</li>
  <li>[CORE-2401] - MSSQL handling timestamp according to sql standard, not sqlserver usage</li>
  <li>[CORE-2402] - Oracle NCLOB defaultValues not read correctly</li>
</ul>

:ET