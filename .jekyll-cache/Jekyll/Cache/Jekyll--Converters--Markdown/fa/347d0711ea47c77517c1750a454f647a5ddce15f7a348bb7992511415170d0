I"<h1 id="formatted-sql-changelogs">Formatted SQL Changelogs</h1>

<p>As of Liquibase 2.0, Liquibase includes support for “plain SQL” changelog files. These changelogs may be included from XML changelogs and may contain arbitrary SQL statements. The statements are converted to <a href="changes/sql.html">custom_sql</a> refactorings.</p>

<p>Formatted SQL files use comments to provide Liquibase with metadata. Each SQL file must begin with the following comment:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">--liquibase formatted sql</span></code></pre></figure>

<h2 id="changesets">Changesets</h2>

<p>Each changeset in a formatted SQL file begins with a comment of the form</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">--changeset author:id attribute1:value1 attribute2:value2 [...]</span></code></pre></figure>

<p>The changeset comment is followed by one or more SQL statements, separated by
semicolons (or the value of the <code class="highlighter-rouge">&lt;endDelimiter&gt;</code> attribute).</p>

<h3 id="available-changeset-attributes">Available Changeset Attributes</h3>

<p>The following attributes may be provided on each changeset:</p>

<table>
<tr><th>Attribute</th><th>Description</th></tr>
<tr><td>stripComments</td><td>Set to true to remove any comments in the SQL before executing, otherwise false. Defaults to true if not set</td></tr>
<tr><td>splitStatements</td><td>Set to false to not have liquibase split statements on ;'s and GO's. Defaults to true if not set</td></tr>
<tr><td>endDelimiter</td><td>Delimiter to apply to the end of the statement.  Defaults to ";", may be set to "".</td></tr>
<tr><td>runAlways</td><td>Executes the change set on every run, even if it has been run before </td></tr>
<tr><td>runOnChange</td><td>Executes the change the first time it is seen and each time the change set has been changed </td></tr>
<tr><td>context</td><td>Executes the change if the particular context was passed at runtime. Any string can be used for the context name and they are checked case-insensitively. </td></tr>
<tr><td>logicalFilePath</td><td>Use to override the file name and path when creating the unique identifier of change sets. Required when moving or renaming change logs. </td></tr>
<tr><td>labels</td><td>Labels are general purpose way to categorize changeSets like contexts, but working in the opposite way. Instead of defining a set of contexts at runtime and then a match expression in the changeSet, you define a set of labels in the context and a match expression at runtime. </td></tr>
<tr><td>runInTransaction</td><td>Should the changeSet be ran as a single transaction (if possible)?  Defaults to true.  <b>Warning: be careful with this attribute.  If set to false and an error occurs part way through running a changeSet containing multiple statements, the Liquibase databasechangelog table will be left in an invalid state</b> </td></tr>
<tr><td>failOnError</td><td>Should the migration fail if an error occurs while executing the changeSet? </td></tr>
<tr><td>dbms</td><td>The type of a database which that changeSet is to be used for. When the migration step is running, it checks the database type against this attribute. Valid database type names are listed on the [supported databases page](../databases.html) </td></tr>
<tr><td>logicalFilePath</td><td>Sets a logical file path in databasechangelog table instead of physical file location of sql where the liquibase executed.</td></tr>
</table>

<h2 id="preconditions">Preconditions</h2>
<p>Preconditions can be specified for each changeset. Currently, only the SQL Check precondition is supported.</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">--preconditions onFail:HALT onError:HALT</span>
<span class="c1">--precondition-sql-check expectedResult:0 SELECT COUNT(*) FROM my_table</span></code></pre></figure>

<h2 id="rollback-actions">Rollback Actions</h2>

<p>Changesets may include statements to be applied when rolling back the changeset. Rollback statements are comments of the form</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">--rollback SQL STATEMENT</span></code></pre></figure>

<h2 id="sample-change-log">Sample Change Log</h2>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="c1">--liquibase formatted sql</span>

<span class="c1">--changeset nvoxland:1</span>
<span class="k">create</span> <span class="k">table</span> <span class="n">test1</span> <span class="p">(</span>
    <span class="n">id</span> <span class="nb">int</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span>
    <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">--rollback drop table test1;</span>

<span class="c1">--changeset nvoxland:2</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test1</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="err">‘</span><span class="n">name</span> <span class="mi">1</span><span class="err">′</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="n">test1</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="err">‘</span><span class="n">name</span> <span class="mi">2</span><span class="err">′</span><span class="p">);</span>

<span class="c1">--changeset nvoxland:3 dbms:oracle</span>
<span class="k">create</span> <span class="n">sequence</span> <span class="n">seq_test</span><span class="p">;</span></code></pre></figure>

:ET